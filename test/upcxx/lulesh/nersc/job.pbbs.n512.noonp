#PBS -q debug
#PBS -l mppwidth=6144
#PBS -l walltime=00:05:00
#PBS -N pbbs
#PBS -j oe
#PBS -V

cd $PBS_O_WORKDIR

setenv GASNET_MAX_SEGSIZE '256MB'

set ITER=6
set UPC_TASK=512
set EXE="./lulesh2.0-noomp"
set LOGDIR="/global/homes/v/vivekk/logs"
set BENCH_OPTIONS="-p -i 100 -s 38"

  set LOGFILE="${LOGDIR}/lulesh.3096.1024.Default.upcxxtasks-${UPC_TASK}.log"
  rm ${LOGFILE}
  set j=0
  while ( $j < ${ITER} )
    # 2 UPC tasks / node. 1 UPC task per socket. Habanero workers varies like 1, 4, 8, 12
    aprun -n ${UPC_TASK} -N 2 -S 1 ${EXE} ${BENCH_OPTIONS} >>& ${LOGFILE}
    set j=`expr ${j} + 1`
  end
  cat $LOGFILE | sed '/resources: utime/d' > "${LOGDIR}.t"
  mv "${LOGDIR}.t" $LOGFILE
end
