#PBS -q debug
#PBS -l mppwidth=2304
#PBS -l walltime=00:15:00
#PBS -N pbbs
#PBS -j oe
#PBS -V

cd $PBS_O_WORKDIR

setenv GASNET_MAX_SEGSIZE '256MB'

set ITER=6
set UPC_TASK=2304
set EXE="./sample_sort"
set LOGDIR="/global/homes/v/vivekk/logs"

set LOGFILE="${LOGDIR}/samplesort.3096.1024.Default.cores-${UPC_TASK}.log"
rm ${LOGFILE}
set j=0
while ( $j < ${ITER} )
  # 2 UPC tasks / node. 1 UPC task per socket. Habanero workers varies like 1, 4, 8, 12
  aprun -n ${UPC_TASK} ${EXE} >>& ${LOGFILE}
  set j=`expr ${j} + 1`
end
cat $LOGFILE | sed '/resources: utime/d' > "${LOGDIR}.t"
mv "${LOGDIR}.t" $LOGFILE
